{% extends 'base.html.twig' %}

{% block title %} Продажа комерческой недвижемости THE BROKER {% endblock %}

{% block body %}
    <h2 class="genus-name">Продажа комерческой недвижемости</h2>

    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
    <table id="custom-filter" border="0" cellspacing="5" cellpadding="5">
        <tbody>
        <tr>
            <td>Общая площадь:</td>
            <td><input class="form-control form-control-sm test" placeholder="ОТ" type="number" id="min" name="min"></td>
            <td><input class="form-control form-control-sm" placeholder="ДО" type="number" id="max" name="max"></td>
            <td class="vl">Этажность:</td>
            <td><input class="form-control form-control-sm" placeholder="ОТ" type="number" id="min1" name="min1"></td>
            <td><input class="form-control form-control-sm" placeholder="ДО" type="number" id="max1" name="max1"></td>
            <td class="vl">Общая стоимость:</td>
            <td><input class="form-control form-control-sm" placeholder="ОТ" type="number" id="min2" name="min"></td>
            <td><input class="form-control form-control-sm" placeholder="ДО" type="number" id="max2" name="max"></td>
            <td class="vl">Цена / m2:</td>
            <td><input class="form-control form-control-sm" placeholder="ОТ" type="number" id="min3" name="min"></td>
            <td><input class="form-control form-control-sm" placeholder="ДО" type="number" id="max3" name="max"></td>
        </tr>
        <tr>

        </tr>
        </tbody>
    </table>
    <hr>

    <table id="example" class="table table-striped table-bordered" style="width:100%">
        <thead>
        <tr>
            <th>Дата обновления</th>
            <th>Название комплекса</th>
            <th>Адресса</th>
            <th>Профиль</th>
            <th>Район</th>
            <th>Название</th>
            <th>Общая площадь</th>
            <th>Этаж</th>
            <th>Этажность</th>
            <th>Цена / m2</th>
            <th>Общая стоимость</th>
            <th>Кон</th>
            <th>Фото</th>
            <th>Описание</th>
{#            <th>ЗА</th>#}
{#            <th>Коментарий</th>#}
        </tr>
        </thead>

        <tbody class="searchable">
        {% for order in orders %}
            <tr>
                <td>{{ order.date|date }}</td>
                <td>{{ order.complexName }}</td>
                <td>{{ order.address }}</td>
                <td>{{ order.profile }}</td>
                <td>{{ order.district }}</td>
                <td>{{ order.name }}</td>
                <td>{{ order.totalArea }}</td>
                <td>{{ order.floor }}</td>
                <td>{{ order.flooring }}</td>
                <td>{{ order.priceM }}</td>
                <td>{{ order.totalPrice }}</td>
                <td>kon</td>
                <td>{{ order.photo }}</td>
                <td>{{ order.description }}</td>
{#                <td>ZA</td>#}
{#                <td data-toggle="modal" data-target="#objectID-{{ order.id }}"><b#}
{#                            class="comment_row">{{ order.comments }}</b></td>#}
            </tr>
        {% endfor %}
        <tfoot>
        <tr>
            <th>Дата обновления</th>
            <th>Название комплекса</th>
            <th>Адресса</th>
            <th>Профиль</th>
            <th>Район</th>
            <th>Название</th>
            <th>Общая площадь</th>
            <th>Этаж</th>
            <th>Этажность</th>
            <th>Цена / m2</th>
            <th>Общая стоимость</th>
            <th>Кон</th>
            <th>Фото</th>
            <th>Описание</th>
{#            <th>ЗА</th>#}
{#            <th>Коментарий</th>#}
        </tr>
        </tfoot>
        </tbody>
    </table>


    <script>
        $(document).ready(function () {
            $('#example').DataTable(
                {
                    initComplete: function () {
                        this.api().columns().every(function () {
                            var column = this;
                            var select = $('<select><option value=""></option></select>')
                                .appendTo($(column.footer()).empty())
                                .on('change', function () {
                                    var val = $.fn.dataTable.util.escapeRegex(
                                        $(this).val()
                                    );

                                    column
                                        .search(val ? '^' + val + '$' : '', true, false)
                                        .draw();
                                });

                            column.data().unique().sort().each(function (d, j) {
                                select.append('<option value="' + d + '">' + d + '</option>')
                            });
                        });
                    },
                    "language": {
                        "lengthMenu": "Отображать _MENU_  записей на странице",
                        "zeroRecords": "Ничего не найдено - извините",
                        "info": "Показано страниц _PAGE_ из _PAGES_",
                        "infoEmpty": "Нет доступных записей",
                        "search": "Поиск",
                        "paginate": {
                            "previous": 'Предыдущий',
                            "next": 'Следующий'
                        },
                        "infoFiltered": "(Отфильтровано из _MAX_ общее количество записей)"
                    },

                    "aLengthMenu": [[5, 10, 25, -1], [5, 10, 25, "Все"]],
                    "iDisplayLength": 5,
                }
            );

        });

        function checkAll(bx) {
            var cbs = document.getElementsByTagName('input');
            for (var i = 0; i < cbs.length; i++) {
                if (cbs[i].type == 'checkbox') {
                    cbs[i].checked = bx.checked;
                }
            }
        }

        sortingBetween('#min', '#max', 6);
        sortingBetween('#min1', '#max1', 8);
        sortingBetween('#min2', '#max2', 10);
        sortingBetween('#min3', '#max3', 9);

        $(document).ready(function () {
            var table = $('#example').DataTable();
            // Event listener to the two range filtering inputs to redraw on input
            $('#max, #max1, #max2, #max3, #min, #min1, #min2, #min3').change(function () {
                table.draw();
            });
        });

        function sortingBetween(idMin, IdMax, number) {
            /* Custom filtering function which will search data in column four between two values */
            $.fn.dataTable.ext.search.push(
                function (settings, data, dataIndex) {
                    var min = parseInt($(idMin).val(), 10);
                    var max = parseInt($(IdMax).val(), 10);
                    var totalArea = parseFloat(data[number]) || 0; // use data for the age column

                    if ((isNaN(min) && isNaN(max)) ||
                        (isNaN(min) && totalArea <= max) ||
                        (min <= totalArea && isNaN(max)) ||
                        (min <= totalArea && totalArea <= max)) {
                        return true;
                    }

                    return false;
                }
            );
        }
    </script>

    {# ===============   Modal window ============= #}
    {% for address in orders %}
        <!-- Modal -->
{#        <div class="modal fade" id="objectID-{{ address.id }}" tabindex="-1" role="dialog"#}
{#             aria-labelledby="exampleModalLabel" aria-hidden="true">#}
{#            <div class="modal-dialog" role="document">#}
{#                <div class="modal-content">#}
{#                    <div class="modal-header">#}
{#                        <h5 class="modal-title" id="exampleModalLabel">Править коментарий</h5>#}
{#                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">#}
{#                            <span aria-hidden="true">&times;</span>#}
{#                        </button>#}
{#                    </div>#}
{#                    <div class="modal-body">#}
{#                        {% if is_granted('ROLE_ADMIN') %}#}
{#                            <form method="post" action="{{ path('editComment', {'id': address.id}) }}">#}
{#                                <textarea name="comment" style="width: 100%">{{ address.comments }}</textarea>#}
{#                                <div class="modal-footer">#}
{#                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>#}
{#                                    <button type="submit" class="btn btn-primary">Сохранить</button>#}
{#                                </div>#}
{#                            </form>#}
{#                        {% else %}#}
{#                            <p>{{ address.comments }}</p>#}
{#                        {% endif %}#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
    {% endfor %}

{#    <br/>#}
{#    <div class="pagination text-center">#}
{#        {{ knp_pagination_render(orders) }}#}
{#    </div>#}

{% endblock %}
